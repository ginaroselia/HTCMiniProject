CREATE TABLE `config` (
  `id` int NOT NULL AUTO_INCREMENT,
  `name` varchar(20) NOT NULL,
  `type` varchar(15) NOT NULL,
  `details` varchar(16000) NOT NULL,
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `updated_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`)
) ENGINE=InnoDB AUTO_INCREMENT=2 DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

INSERT INTO `config` VALUES (1,'ImagePath','string','C:\\PathNameHere ','2025-07-20 22:17:54','2025-07-20 22:17:54');

CREATE TABLE `request_queue` (
  `id_code` int AUTO_INCREMENT NOT NULL,
  `type` tinyint NOT NULL COMMENT '1 = Detection, 2 = Classification',
  `status` tinyint NOT NULL DEFAULT '0',
  `created_date` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  `completed_date` datetime DEFAULT NULL,
  PRIMARY KEY (`id_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;


CREATE TABLE `request_result` (
  `q_id` int NOT NULL,
  `type` int NOT NULL COMMENT '1 = Classification, 2 = Object Detection',
  `result` varchar(45) NOT NULL,
  `confidence` decimal(5,2) DEFAULT NULL,
  `created_at` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`q_id`,`result`,`type`),
  CONSTRAINT `q_id` FOREIGN KEY (`q_id`) REFERENCES `request_queue` (`id_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `request_result_image` (
  `q_id` int NOT NULL,
  `image` text,
  PRIMARY KEY (`q_id`),
  CONSTRAINT `queue_id` FOREIGN KEY (`q_id`) REFERENCES `request_queue` (`id_code`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

CREATE TABLE `request_url` (
  `q_id` int NOT NULL,
  `type` tinyint NOT NULL,
  `url` varchar(16000) NOT NULL,
  `created_date` datetime NOT NULL DEFAULT CURRENT_TIMESTAMP,
  PRIMARY KEY (`q_id`,`type`),
  CONSTRAINT `url_queue_id` FOREIGN KEY (`q_id`) REFERENCES `request_queue` (`id_code`) ON DELETE RESTRICT ON UPDATE CASCADE
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;

ALTER TABLE `request_result` 
ADD COLUMN `ai_model` INT NULL DEFAULT 0 AFTER `confidence`,
DROP PRIMARY KEY,
ADD PRIMARY KEY (`q_id`, `type`, `result`);
;

CREATE TABLE `request_log` (
  `id` INT NOT NULL,
  `model_id` INT NULL DEFAULT 0,
  `q_id` INT NULL,
  `start_time` DATETIME NULL,
  `end_time` DATETIME NULL,
  PRIMARY KEY (`id`),
  CONSTRAINT `ai_q_id`
    FOREIGN KEY (`id`)
    REFERENCES `request_queue` (`id_code`)
    ON DELETE RESTRICT
    ON UPDATE NO ACTION);
